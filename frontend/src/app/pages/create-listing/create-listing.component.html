<div class="create-listing-page">
  <div class="page-header">
    <h1>Create Listing</h1>
    <p>List your item for sale to fellow Gators</p>
  </div>

  <form class="listing-form" (ngSubmit)="submit()">
    @if (error) {
      <div class="error-message">
        {{ error }}
      </div>
    }

    <!-- Images Section -->
    <div class="form-section">
      <h3>üì∏ Photos</h3>
      <p class="section-hint">Add up to 5 photos. The first photo will be the cover.</p>

      <div class="images-grid">
        @for (image of images; track image; let i = $index) {
          <div class="image-item">
            <img [src]="image" alt="Listing image">
            <button type="button" class="remove-btn" (click)="removeImage(i)">√ó</button>
            @if (i === 0) {
              <span class="cover-badge">Cover</span>
            }
          </div>
        }
        
        @if (images.length < 5) {
          <label class="upload-btn" [class.uploading]="uploadingImage">
            <input 
              type="file" 
              accept="image/*" 
              (change)="onFileSelected($event)"
              [disabled]="uploadingImage">
            @if (uploadingImage) {
              <span>Uploading...</span>
            } @else {
              <span class="plus">+</span>
              <span>Add Photo</span>
            }
          </label>
        }
      </div>
    </div>

    <!-- Details Section -->
    <div class="form-section">
      <h3>üìù Details</h3>

      <div class="form-group">
        <label for="title">Title *</label>
        <input 
          type="text" 
          id="title" 
          [(ngModel)]="title" 
          name="title"
          placeholder="What are you selling?"
          [disabled]="isLoading()">
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          [(ngModel)]="description" 
          name="description"
          placeholder="Describe your item (condition, size, reason for selling, etc.)"
          rows="4"
          [disabled]="isLoading()"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="price">Price *</label>
          <div class="price-input">
            <span class="currency">$</span>
            <input 
              type="number" 
              id="price" 
              [(ngModel)]="price" 
              name="price"
              placeholder="0.00"
              step="0.01"
              min="0"
              [disabled]="isLoading()">
          </div>
        </div>

        <div class="form-group">
          <label for="category">Category *</label>
          <select 
            id="category" 
            [(ngModel)]="categoryId" 
            name="categoryId"
            [disabled]="isLoading()">
            <option [ngValue]="null">Select a category</option>
            @for (cat of categories(); track cat.id) {
              <option [ngValue]="cat.id">{{ cat.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="condition">Condition</label>
          <select 
            id="condition" 
            [(ngModel)]="condition" 
            name="condition"
            [disabled]="isLoading()">
            <option value="">Select condition</option>
            @for (cond of conditions; track cond.value) {
              <option [value]="cond.value">{{ cond.label }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label for="location">Pickup Location</label>
          <input 
            type="text" 
            id="location" 
            [(ngModel)]="location" 
            name="location"
            placeholder="e.g., Marston Library, Turlington"
            [disabled]="isLoading()">
        </div>
      </div>
    </div>

    <!-- Submit -->
    <div class="form-actions">
      <a routerLink="/" class="btn-cancel">Cancel</a>
      <button type="submit" class="btn-submit" [disabled]="isLoading()">
        @if (isLoading()) {
          Creating...
        } @else {
          Post Listing
        }
      </button>
    </div>
  </form>
</div>
